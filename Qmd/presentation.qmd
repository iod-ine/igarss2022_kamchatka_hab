---
title: "Remote sensing evidence for the 2020 harmful algal bloom in Kamchatka"
subtitle: "A remote sensing study in the reproducible research framework"
date: July 17, 2022
author: Ivan Dubrovin
format:
  revealjs:
    logo: Skoltech_Logo_Black.png
    theme: [simple, theme.scss]
    fig-dpi: 300
---

```{r}
#| include: false
#| label: setup
knitr::opts_knit$set(root.dir = here::here())
library(targets)
library(tmap)
```

## Two parts of the presentation

**Full title:** Remote sensing evidence for the harmful algal bloom explanation of the ecological situation in Kamchatka in autumn of 2020

. . .

:::: {.columns}
::: {.column width="50%"}
### The study
* Very generic 
* Sentinel-3 OLCI^[Ocean and Land Color Instrument] data
* Chl anomaly time-series
* Trace the history of the HAB
:::
::: {.column width="50%"}
### The approach
* Reproducible research framework
* *(almost)*^[There is no way to automate LTA Sentinel-3 data retrieval] All processing done in code
* Dynamic paper and presentation
* Fully open source
:::
::::

::: {.notes}
The full title of our paper is "Remote Sensing Evidence For The Harmful Algal Bloom Explanation Of The Ecological Situation In Kamchatka In Autumn Of 2020."
By itself, this is not a very interesting study.
We simply look at chlorophyll concentration anomaly time series over the east coast of Kamchatka peninsula for the dates of a suspected algal bloom event.
I think the approach we adopted is more interesting than the study itself. <NEXT>.
The study is very generic.
The main information source is the Sentinel-3 mission, specifically the Ocean and Land Color instrument.
One of its products is the estimated chlorophyll concentration in the water.
We recalculated these concentrations into a time-series of chlorophyll anomalies and used it to trace the suspected bloom in time.
I am sure most of you have seen many similar studies, so I will try not to focus on it too much.

The approach we took focuses on reproducibility. Almost every step of the study is automated using scripts.
I say almost because I don't think there is a way to automate the retrieval of long-term Sentinel-3 ocean data yet.
The EUMETSAT team is working on a new platform that will have an API, which would allow full end-to-end automation, but for now, the only way to access the data is to search through the archive manually.
The PDF of the paper and the HTML of this presentation are dynamic documents, meaning that they are generated from the results of the code automatically.
And, of course, all our code is open and available on GitHub.
:::

# Part 1: The study

## Background

At the end of September of 2020 media widely reported an environmental disaster on the eastern coast of Kamchatka.

::: {.incremental}
* Massive die-off of marine life
* Poisoning symptoms in surfers
* Discoloration and foam formation
* Several expeditions on site
:::

. . .

All of theses can be explained by a *bloom of toxic algae*.
Can we additionally support that hypothesis with remote sensing data?

::: {.notes}
At the end of September -- beginning of October 2020, an environmental disaster was widely reported on the eastern coast of Kamchatka. <NEXT>
A storm washed many dead marine animals to the shore, which initiated an outcry over the media. <NEXT>
Reports of poisoning symptoms, skin and eye irritation from surfers in the area surfaced and added fuel to the growing public belief in some unspecified anthropogenic pollution. <NEXT> 
Photos of discolored water and foam along the coast circulated in social media. <NEXT>
Several expeditions were sent to the site to investigate, the most notable being the group of researchers from the Far Eastern Federal University.
They considered multiple possible explanations of the events, both technogenic and natural, and ultimately concluded that the most likely explanation <NEXT> is the bloom of toxic algae.
A harmful algal bloom would explain all observations.
We wanted to see if remote sensing data aligns with this hypothesis.
:::

## Region of interest

```{r}
#| label: roi-map
roi_map <- tar_read(roi_map)

ivp <- grid::viewport(
  x = 0.54, y = 0.072,
  width = 0.3, height = 0.3,
  just = c("left", "bottom"),
)

print(roi_map$main)
print(roi_map$inset, vp = ivp)
```

::: footer
Southeast coast of Kamchatka peninsula.
:::

::: {.notes}
This is the map of the region of interest.
It's the southeast part of the Kamchatka peninsula.
The red dot marks the beach where surfers reported poisoning symptoms.
Along the coast of Avacha bay, many dead marine animals were washed onto the shore.
:::

## Data

The primary data source was the **Sentinel-3** mission. 

* OLCI^[Ocean and Land Color Instrument] chl concentrations [300 m, 1.9 days]
* SLSTR^[Sea and Land Surface Temperature Radiometer] sea surface temperature

. . . 

Where available, **Sentinel-2** MSI^[Multispectral instrument] data [10 m].
Processed using C2RCC^[Case 2 Regional Coast Color] in SNAP to extract chl concentrations. 

::: {.notes}
The primary data source for our analysis was the Sentinel-3 mission.
We worked with a time series of chlorophyll concentrations from 76 level 2 OLCI products covering June to November.
We also looked at sea surface temperatures from SLSTR products covering August to October 2017-2020 to check if there was a temperature anomaly compared to the previous years. <NEXT>
Where possible, we additionally looked at Sentinel-2 images, which offer much more detailed data with a spatial resolution of 10 meters, but a longer revisit period compared to Sentinel-3, making it much harder to find suitable images.
The total of 13 products were not covered by clouds, and we processed them with C2RCC to extract chlorophyll concentrations and produce atmospherically corrected true color images.
This is the same algorithm used in Sentinel-3.
:::

## Methods

**Relative chl anomaly**.
A reference concentration $\text{Chl-a}^{\text{ref}}$ for any given date is the median across the 61-day period ending 15 days before. 

$$
\Delta_r \text{Chl-a} = \frac{\text{Chl-a} - \text{Chl-a}^{\text{ref}}}{\text{Chl-a}^{\text{ref}}}.
$$

. . .

Visual analysis of the time-series of relative chl anomalies.

::: {.notes}
To assess the presence of an algal bloom, we used relative chlorophyll anomaly maps to put observed concentrations into the context of average concentration over the recent past.
A reference concentration for any given date was calculated as a median across all images obtained in the 61-day period ending 15 days before.
We used a rolling window calculation, so each day had a unique reference. <NEXT>
Then we visually analyzed the time-series of relative anomaly maps to see if the chlorophyll concentrations follow the timeline of the events.
:::

## Chlorophyll anomaly evolution

# Part 2: The approach

## Literate programming

Literate programming is a programming paradigm introduced by Donald Knuth in which a computer program is given an explanation of its logic in a natural language, such as English, interspersed with snippets of macros and traditional source code, from which compilable source code can be generated.

Any change is automatically included into the output: no copy-pasting of images, no chance to forget to update the final result.

## Constituents

* R Markdown
* Quarto
* Python
* R

## Python and R

Very easy to use together

### Python
- Wrapper around SNAP GPT
- `lxml`

### R
- Processing and visualization of spatial outputs
- `sf`, `terra`, `tmap`, `targets`, `knitr`

## R Markdown and Quarto

## Target network

```{r}
#| echo: false
tar_visnetwork(targets_only = TRUE)
```

::: footer
How to automate the data retrieval?
:::

## How to recreate the results

Run the pipeline.

```r
targets::tar_make()
```

Compile the paper pdf.

```r
knitr::knit()
```

Generate the presentation html.

```shell
quarto render
```

::: footer
Assuming you got the archived Sentinel-3 data.
:::
